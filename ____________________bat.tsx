@echo off
chcp 65001 >nul
title ูุธุงู ุงูุญุถูุฑ ูุงูุฃูู ุงูุฐูู - ุงูุชุซุจูุช ุงููุงูู
color 0B

echo.
echo โโโโโโโโโโโโ  โโโโโโโโโโ โโโโโโโโโโโโโโโโ    โโโโโโ โโโ
echo โโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโ
echo    โโโ   โโโโโโโโโโโโโโโโโโโโโโ  โโโโโโ     โโโโโโโโโโโ
echo    โโโ   โโโโโโโโโโโโโโโโโโโโโโ  โโโโโโ     โโโโโโโโโโโ
echo    โโโ   โโโ  โโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโ
echo    โโโ   โโโ  โโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโ
echo.
echo ================================================
echo      ูุธุงู ุฅุฏุงุฑุฉ ุงูุญุถูุฑ ูุงูุฃูู ุงูุฐูู v2.0
echo      ุชุซุจูุช ุดุงูู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุฐูุงุก ุงูุงุตุทูุงุนู
echo ================================================
echo.

:: ุงูุชุญูู ูู Python
echo [1/6] ูุญุต Python...
python --version >nul 2>&1
if %ERRORLEVEL% NEQ 0 (
    echo โ Python ุบูุฑ ูุซุจุช!
    echo ๐ฅ ูุฑุฌู ุชุซุจูุช Python ูู: https://python.org
    echo    ุชุฃูุฏ ูู ุฅุถุงูุฉ Python ุฅูู PATH
    pause
    exit /b 1
)
echo โ Python ูุซุจุช ุจูุฌุงุญ

:: ุงูุชุญูู ูู Node.js
echo.
echo [2/6] ูุญุต Node.js...
node --version >nul 2>&1
if %ERRORLEVEL% NEQ 0 (
    echo โ Node.js ุบูุฑ ูุซุจุช!
    echo ๐ฅ ูุฑุฌู ุชุซุจูุช Node.js ูู: https://nodejs.org
    pause
    exit /b 1
)
echo โ Node.js ูุซุจุช ุจูุฌุงุญ

:: ุชุซุจูุช ููุชุจุงุช Python
echo.
echo [3/6] ุชุซุจูุช ููุชุจุงุช Python ููุฐูุงุก ุงูุงุตุทูุงุนู...
cd backend
if not exist requirements.txt (
    echo โ ููู requirements.txt ุบูุฑ ููุฌูุฏ!
    pause
    exit /b 1
)

echo ๐ง ุชุซุจูุช ุงูููุชุจุงุช ุงูุฃุณุงุณูุฉ...
python -m pip install --upgrade pip
python -m pip install -r requirements.txt

if %ERRORLEVEL% NEQ 0 (
    echo โ๏ธ ุจุนุถ ุงูููุชุจุงุช ูุดูุช ูู ุงูุชุซุจูุชุ ุฌุงุฑู ุงููุญุงููุฉ ุจุทุฑููุฉ ุจุฏููุฉ...
    python -m pip install flask flask-cors opencv-python numpy scikit-learn pandas pillow
)

cd..
echo โ ุชู ุชุซุจูุช ููุชุจุงุช Python

:: ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
echo.
echo [4/6] ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุญููุฉ...
if not exist database mkdir database
python database/init_database.py
if %ERRORLEVEL% NEQ 0 (
    echo โ ูุดู ูู ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช!
    pause
    exit /b 1
)
echo โ ุชู ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ

:: ุชุซุจูุช ููุชุจุงุช Node.js
echo.
echo [5/6] ุชุซุจูุช ููุชุจุงุช ุงููุงุฌูุฉ ุงูุฃูุงููุฉ...
if exist node_modules (
    echo ๐งน ุญุฐู ุงูููุชุจุงุช ุงููุฏููุฉ...
    rmdir /s /q node_modules
)

if exist package-lock.json del package-lock.json

echo ๐ฆ ุชุซุจูุช ุงูููุชุจุงุช...
npm install
if %ERRORLEVEL% NEQ 0 (
    echo โ ูุดู ูู ุชุซุจูุช ููุชุจุงุช Node.js!
    echo ๐ ุฌุงุฑู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู...
    npm install --force
)
echo โ ุชู ุชุซุจูุช ููุชุจุงุช ุงููุงุฌูุฉ ุงูุฃูุงููุฉ

:: ุฅูุดุงุก ูููุงุช ุงูุชุดุบูู
echo.
echo [6/6] ุฅูุดุงุก ูููุงุช ุงูุชุดุบูู ุงูุณุฑูุน...

:: ููู ุชุดุบูู ุงููุธุงู ุงููุงูู
echo @echo off > ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo chcp 65001 ^>nul >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo title ูุธุงู ุงูุญุถูุฑ ูุงูุฃูู ุงูุฐูู - ุชุดุบูู >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo color 0B >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo. >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo ================================================ >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo      ๐ ุชุดุบูู ูุธุงู ุงูุญุถูุฑ ูุงูุฃูู ุงูุฐูู >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo ================================================ >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo. >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo [1/3] ุจุฏุก ุชุดุบูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุฐูุงุก ุงูุงุตุทูุงุนู... >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo start "ุฎุงุฏู ุงูุฐูุงุก ุงูุงุตุทูุงุนู" /min cmd /c "cd backend && python app.py" >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo timeout /t 3 /nobreak ^>nul >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo โ ุชู ุชุดุบูู ุฎุงุฏู ุงูุฐูุงุก ุงูุงุตุทูุงุนู >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo. >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo [2/3] ุจุฏุก ุชุดุบูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ... >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo start "ูุงุฌูุฉ ุงููุธุงู" cmd /c "npm run dev" >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo timeout /t 5 /nobreak ^>nul >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo โ ุชู ุชุดุบูู ูุงุฌูุฉ ุงููุธุงู >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo. >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo [3/3] ูุชุญ ุงููุธุงู ูู ุงููุชุตูุญ... >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo timeout /t 3 /nobreak ^>nul >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo start http://localhost:3000 >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo. >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo ================================================ >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo โ ุงููุธุงู ูุนูู ุงูุขู! >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo ๐ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ: http://localhost:3000 >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo ๐ค ุฎุงุฏู ุงูุฐูุงุก ุงูุงุตุทูุงุนู: http://localhost:5000 >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo ๐ ูุงุนุฏุฉ ุงูุจูุงูุงุช: SQLite ูุญููุฉ >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo. >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo ๐ก ูุฅููุงู ุงููุธุงู: ุฃุบูู ูุฐู ุงููุงูุฐุฉ >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo echo ================================================ >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat
echo pause >> ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat

:: ููู ุชุดุบูู ุณุฑูุน
echo @echo off > ุชุดุบูู_ุณุฑูุน.bat
echo start "ูุธุงู ุงูุญุถูุฑ ุงูุฐูู" cmd /c "ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat" >> ุชุดุบูู_ุณุฑูุน.bat

echo โ ุชู ุฅูุดุงุก ูููุงุช ุงูุชุดุบูู

echo.
echo ================================================
echo โ ุชู ุชุซุจูุช ุงููุธุงู ุจูุฌุงุญ!
echo ================================================
echo.
echo ๐ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!
echo.
echo ๐ ุงููููุงุช ุงููููุฉ:
echo    โข ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat  : ุชุดุบูู ุงููุธุงู ูุงููุงู
echo    โข ุชุดุบูู_ุณุฑูุน.bat           : ุชุดุบูู ุณุฑูุน
echo    โข database/smart_attendance.db : ูุงุนุฏุฉ ุงูุจูุงูุงุช
echo    โข backend/app.py             : ุฎุงุฏู ุงูุฐูุงุก ุงูุงุตุทูุงุนู
echo.
echo ๐ ูุจุฏุก ุงูุชุดุบูู: ุงููุฑ ุนูู "ุชุดุบูู_ุงููุธุงู_ุงููุงูู.bat"
echo.
echo โก ุงูููุฒุงุช ุงููุชุงุญุฉ:
echo    โ ูุงุนุฏุฉ ุจูุงูุงุช SQLite ูุญููุฉ
echo    โ ุฐูุงุก ุงุตุทูุงุนู ููุชุนุฑู ุงูุญููู
echo    โ ุชุญููู ุงูุฃููุงุท ูุงูุณููููุงุช
echo    โ ูุดู ุงูุญุงูุงุช ุงูุดุงุฐุฉ
echo    โ ูุงุฌูุฉ ุนุฑุจูุฉ ูุชูุฏูุฉ
echo    โ ูุนูู ุจุฏูู ุฅูุชุฑูุช
echo.
pause