@echo off
chcp 65001 >nul
title ูุธุงู ุงูุญุถูุฑ ูุงูุฃูู ุงูุฐูู - ุชุดุบูู
color 0B

echo ================================================
echo      ๐ ุชุดุบูู ูุธุงู ุงูุญุถูุฑ ูุงูุฃูู ุงูุฐูู
echo ================================================
echo.

REM ุงูุชุญูู ูู ูุฌูุฏ ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ
if not exist "backend\venv" (
    echo โ ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ ุบูุฑ ููุฌูุฏุฉ! ูุฑุฌู ุงูุชุดุบูู ููุณุคูู ุฃููุงู
    echo ๐ง ุฌุงุฑู ุฅูุดุงุก ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ...
    python -m venv backend\venv
    if errorlevel 1 (
        echo โ ูุดู ูู ุฅูุดุงุก ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ
        pause
        exit /b 1
    )
)

echo [1/4] ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ ููุจุงูุซูู...
call backend\venv\Scripts\activate.bat
if errorlevel 1 (
    echo โ ูุดู ูู ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ
    pause
    exit /b 1
)

echo [2/4] ุชุซุจูุช ูุชุทูุจุงุช ุงูุจุงูุซูู...
pip install -r backend\requirements.txt
if errorlevel 1 (
    echo โ๏ธ ููุงู ูุดููุฉ ูู ุจุนุถ ุงูุญุฒูุ ุฌุงุฑู ุงูุชุซุจูุช ุงูุจุฏูู...
    pip install flask flask-cors cryptography argon2-cffi opencv-python pillow
)

echo [3/4] ุจุฏุก ุชุดุบูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุงูุฐูุงุก ุงูุงุตุทูุงุนู...
start "ุฎุงุฏู ุงูุฐูุงุก ุงูุงุตุทูุงุนู" /min cmd /k "cd backend && call venv\Scripts\activate.bat && python app.py"
timeout /t 5 /nobreak >nul

echo [4/4] ุจุฏุก ุชุดุบูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ...
start "ูุงุฌูุฉ ุงููุธุงู" cmd /k "npm run dev"
timeout /t 8 /nobreak >nul


echo ================================================
echo โ ุงููุธุงู ูุนูู ุงูุขู!
echo ๐ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ: http://localhost:3000
echo ๐ค ุฎุงุฏู ุงูุฐูุงุก ุงูุงุตุทูุงุนู: http://localhost:5000
echo ๐ ูุงุนุฏุฉ ุงูุจูุงูุงุช: SQLite ูุญููุฉ
echo.
echo ๐ก ูุฅููุงู ุงููุธุงู: ุฃุบูู ูุฐู ุงููุงูุฐุฉ
echo ๐ป ููุชุตุญูุญ: ุงูุชุญ ููุงูุฐ ุงูุฃูุงูุฑ ุงููููุตูุฉ
echo ================================================

REM ุงูุงูุชุธุงุฑ ูุฅุนุทุงุก ุงูููุช ูููุธุงู ููุจุฏุก ุงููุงูู
timeout /t 10 /nobreak >nul

REM ุงูุชุญูู ูู ุฃู ุงููุธุงู ูุนูู
echo.
echo ๐ ุฌุงุฑู ุงูุชุญูู ูู ุญุงูุฉ ุงููุธุงู...
curl -f http://localhost:3000 >nul 2>&1
if errorlevel 1 (
    echo โ๏ธ ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ูุง ุชุณุชุฌูุจุ ุฌุงุฑู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู...
    timeout /t 5 /nobreak >nul
)

curl -f http://localhost:5000 >nul 2>&1
if errorlevel 1 (
    echo โ๏ธ ุงูุฎุงุฏู ุงูุฎููู ูุง ูุณุชุฌูุจุ ูุฏ ูููู ููุงู ุฎุทุฃ ูู ุงูุชุซุจูุช
    echo ๐ ุฑุงุฌุน ููุงูุฐ ุงูุฃูุงูุฑ ุงููููุตูุฉ ููุฃุฎุทุงุก
)

echo.
echo โ ุชู ุชุดุบูู ุงููุธุงู ุจูุฌุงุญ!
echo ๐ฏ ููููู ุงูุขู ุงุณุชุฎุฏุงู ุงููุธุงู ุนูู http://localhost:3000
pause